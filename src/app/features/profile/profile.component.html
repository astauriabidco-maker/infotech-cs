<app-header></app-header>

<main class="profile-page">
  <div class="container">
    <h1 class="page-title">Mon Profil</h1>

    @if (isLoading()) {
      <div class="loading-state">
        <div class="spinner"></div>
        <p>Chargement du profil...</p>
      </div>
    } @else if (profile()) {
      <div class="profile-content">
        <!-- Profile Info Card -->
        <div class="card profile-card">
          <div class="card-header">
            <h2>Informations Personnelles</h2>
            @if (!isEditing()) {
              <button class="btn btn-secondary" (click)="toggleEdit()">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="currentColor" stroke-width="2"/>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2"/>
                </svg>
                Modifier
              </button>
            }
          </div>
          
          <div class="card-body">
            @if (!isEditing()) {
              <div class="info-grid">
                <div class="info-item">
                  <label>Email</label>
                  <p>{{ profile()!.email }}</p>
                </div>
                <div class="info-item">
                  <label>Nom d'affichage</label>
                  <p>{{ profile()!.displayName || 'Non renseign√©' }}</p>
                </div>
                <div class="info-item">
                  <label>R√¥les</label>
                  <div class="roles-list">
                    @for (role of profile()!.roles; track role) {
                      <span class="badge badge-primary">{{ role.replace('ROLE_', '') }}</span>
                    }
                  </div>
                </div>
                <div class="info-item">
                  <label>Membre depuis</label>
                  <p>{{ profile()!.createdAt | date: 'dd MMMM yyyy' }}</p>
                </div>
              </div>

              @if (profile()!.sellerInfo) {
                <div class="seller-info">
                  <h3>Informations Vendeur</h3>
                  <div class="info-grid">
                    <div class="info-item">
                      <label>Nom de la boutique</label>
                      <p>{{ profile()!.sellerInfo!.shopName }}</p>
                    </div>
                    <div class="info-item">
                      <label>Description</label>
                      <p>{{ profile()!.sellerInfo!.description || 'Aucune description' }}</p>
                    </div>
                    <div class="info-item">
                      <label>Email de contact</label>
                      <p>{{ profile()!.sellerInfo!.contactEmail }}</p>
                    </div>
                  </div>
                </div>
              }
            } @else {
              <form class="edit-form">
                <div class="form-group">
                  <label>Nom d'affichage</label>
                  <input 
                    type="text" 
                    class="form-input" 
                    [(ngModel)]="displayName"
                    name="displayName"
                    placeholder="Votre nom">
                </div>

                @if (profile()!.sellerInfo) {
                  <h3 class="form-section-title">Informations Vendeur</h3>
                  <div class="form-group">
                    <label>Nom de la boutique</label>
                    <input 
                      type="text" 
                      class="form-input" 
                      [(ngModel)]="shopName"
                      name="shopName"
                      placeholder="Nom de votre boutique">
                  </div>
                  <div class="form-group">
                    <label>Description</label>
                    <textarea 
                      class="form-input" 
                      rows="4"
                      [(ngModel)]="shopDescription"
                      name="shopDescription"
                      placeholder="D√©crivez votre boutique"></textarea>
                  </div>
                  <div class="form-group">
                    <label>Email de contact</label>
                    <input 
                      type="email" 
                      class="form-input" 
                      [(ngModel)]="contactEmail"
                      name="contactEmail"
                      placeholder="contact@example.com">
                  </div>
                }

                <div class="form-actions">
                  <button type="button" class="btn btn-secondary" (click)="toggleEdit()">Annuler</button>
                  <button type="button" class="btn btn-primary" (click)="saveProfile()">Enregistrer</button>
                </div>
              </form>
            }
          </div>
        </div>

        <!-- Quick Links Admin -->
        @if (hasRole('ROLE_ADMIN')) {
          <div class="card admin-card">
            <div class="card-header">
              <h2>üîê Administration</h2>
            </div>
            <div class="card-body">
              <a routerLink="/admin/dashboard" class="btn btn-primary btn-block">
                Acc√©der au tableau de bord Admin
              </a>
            </div>
          </div>
        }

        <!-- Quick Links Seller -->
        @if (hasRole('ROLE_SELLER')) {
          <div class="card seller-card">
            <div class="card-header">
              <h2>üè™ Espace Vendeur</h2>
            </div>
            <div class="card-body">
              <a routerLink="/seller/dashboard" class="btn btn-primary btn-block">
                Acc√©der √† mon espace vendeur
              </a>
            </div>
          </div>
        }

        <!-- Security -->
        <div class="card">
          <div class="card-header">
            <h2>S√©curit√©</h2>
          </div>
          <div class="card-body">
            <button class="btn btn-secondary btn-block" (click)="openPasswordModal()">
              Changer le mot de passe
            </button>
          </div>
        </div>

        <!-- Danger Zone -->
        <div class="card danger-card">
          <div class="card-header">
            <h2>‚ö†Ô∏è Zone de danger</h2>
          </div>
          <div class="card-body">
            <p class="danger-text">La suppression de votre compte est irr√©versible.</p>
            <button class="btn btn-danger btn-block" (click)="deleteAccount()">
              Supprimer mon compte
            </button>
          </div>
        </div>
      </div>
    }
  </div>
</main>

<!-- Password Modal -->
@if (showPasswordModal()) {
  <div class="modal-overlay" (click)="closePasswordModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Changer le mot de passe</h2>
        <button class="close-btn" (click)="closePasswordModal()">√ó</button>
      </div>
      <form class="modal-body">
        <div class="form-group">
          <label>Ancien mot de passe</label>
          <input type="password" class="form-input" [(ngModel)]="oldPassword" name="oldPassword">
        </div>
        <div class="form-group">
          <label>Nouveau mot de passe</label>
          <input type="password" class="form-input" [(ngModel)]="newPassword" name="newPassword">
        </div>
        <div class="form-group">
          <label>Confirmer</label>
          <input type="password" class="form-input" [(ngModel)]="confirmPassword" name="confirmPassword">
        </div>
      </form>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closePasswordModal()">Annuler</button>
        <button class="btn btn-primary" (click)="changePassword()">Valider</button>
      </div>
    </div>
  </div>
}

<app-footer></app-footer>
