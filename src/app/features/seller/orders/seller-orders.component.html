<app-header></app-header>

<main class="seller-orders-page">
  <div class="container">
    <div class="page-header">
      <div>
        <h1 class="page-title">Mes Ventes</h1>
        <p class="page-description">Gérez vos commandes clients</p>
      </div>
    </div>

    <!-- Barre de recherche -->
    <div class="search-section">
      <div class="search-box">
        <svg class="search-icon" viewBox="0 0 24 24" fill="none">
          <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
          <path d="m21 21-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <input 
          type="text" 
          class="search-input" 
          placeholder="Rechercher par numéro de commande (ex: INF-123456-0001)"
          [ngModel]="searchQuery()"
          (ngModelChange)="searchQuery.set($event)">
        @if (searchQuery()) {
          <button class="clear-search" (click)="clearSearch()">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M18 6 6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        }
      </div>
      @if (searchQuery() && filteredOrders().length !== orders().length) {
        <div class="search-results-info">
          {{ filteredOrders().length }} résultat(s) trouvé(s) pour "{{ searchQuery() }}"
        </div>
      }
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon revenue">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ getTotalRevenue() | number:'1.2-2' }} €</div>
          <div class="stat-label">Chiffre d'affaires total</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon orders">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" stroke="currentColor" stroke-width="2"/>
            <rect x="8" y="2" width="8" height="4" rx="1" stroke="currentColor" stroke-width="2"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ orders().length }}</div>
          <div class="stat-label">Commandes totales</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon pending">
          <svg viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
            <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ getPendingOrdersCount() }}</div>
          <div class="stat-label">En attente</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon shipped">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M16 3h5v13h-2M16 16h3M1 16h11M1 16l4-9h11l4 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="5.5" cy="18.5" r="2.5" stroke="currentColor" stroke-width="2"/>
            <circle cx="16.5" cy="18.5" r="2.5" stroke="currentColor" stroke-width="2"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ getShippedOrdersCount() }}</div>
          <div class="stat-label">Expédiées</div>
        </div>
      </div>
    </div>

    @if (isLoading()) {
      <div class="loading-state">
        <div class="spinner"></div>
        <p>Chargement des commandes...</p>
      </div>
    } @else if (filteredOrders().length === 0) {
      <div class="empty-state">
        @if (searchQuery()) {
          <svg class="empty-icon" viewBox="0 0 24 24" fill="none">
            <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
            <path d="m21 21-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <h3>Aucun résultat trouvé</h3>
          <p>Aucune commande ne correspond à "{{ searchQuery() }}"</p>
          <button class="btn-clear" (click)="clearSearch()">Effacer la recherche</button>
        } @else {
          <svg class="empty-icon" viewBox="0 0 24 24" fill="none">
            <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" stroke="currentColor" stroke-width="2"/>
            <rect x="8" y="2" width="8" height="4" rx="1" stroke="currentColor" stroke-width="2"/>
          </svg>
          <h3>Aucune commande pour le moment</h3>
          <p>Les commandes contenant vos produits apparaîtront ici</p>
        }
      </div>
    } @else {
      <div class="orders-list">
        @for (order of filteredOrders(); track order.id) {
          <div class="order-card">
            <div class="order-header">
              <div class="order-info">
                <h3 class="order-number">{{ getOrderNumber(order) }}</h3>
                <span class="order-date">{{ order.createdAt | date:'dd/MM/yyyy à HH:mm' }}</span>
              </div>
              <span class="badge" [ngClass]="getStatusBadgeClass(order.status)">
                {{ getStatusText(order.status) }}
              </span>
            </div>

            <div class="order-items">
              @for (item of order.items; track item.id) {
                <div class="order-item">
                  <div class="item-info">
                    <h4 class="item-title">{{ item.productTitle }}</h4>
                    <div class="item-meta">
                      <span class="item-quantity">Quantité : {{ item.quantity }}</span>
                      @if (item.conditionNote) {
                        <span class="item-condition">{{ item.conditionNote }}</span>
                      }
                    </div>
                    @if (item.insurance) {
                      <div class="item-insurance">
                        <svg viewBox="0 0 24 24" fill="none" width="14" height="14">
                          <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span>{{ item.insurance.name }}</span>
                        <span class="insurance-price">+{{ item.insurance.price | number:'1.2-2' }} €</span>
                      </div>
                    }
                  </div>
                  <div class="item-price">{{ item.price | number:'1.2-2' }} €</div>
                </div>
              }
            </div>

            <div class="order-footer">
              <div class="order-total">
                <span class="total-label">Total commande :</span>
                <span class="total-amount">{{ order.total | number:'1.2-2' }} €</span>
              </div>
              <div class="order-actions">
                <a [routerLink]="['/orders', order.id]" class="btn btn-sm btn-secondary">
                  <svg viewBox="0 0 24 24" fill="none">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2"/>
                    <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                  </svg>
                  Détails
                </a>
                @if (order.status === 'PAID') {
                  <button 
                    class="btn btn-sm btn-primary"
                    (click)="markAsShipped(order)"
                    [disabled]="updatingOrderId() === order.id">
                    @if (updatingOrderId() === order.id) {
                      <span class="btn-spinner"></span>
                      Mise à jour...
                    } @else {
                      <svg viewBox="0 0 24 24" fill="none">
                        <path d="M16 3h5v13h-2M16 16h3M1 16h11M1 16l4-9h11l4 9" stroke="currentColor" stroke-width="2"/>
                        <circle cx="5.5" cy="18.5" r="2.5" stroke="currentColor" stroke-width="2"/>
                        <circle cx="16.5" cy="18.5" r="2.5" stroke="currentColor" stroke-width="2"/>
                      </svg>
                      Marquer comme expédiée
                    }
                  </button>
                }
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>
</main>

<app-footer></app-footer>
