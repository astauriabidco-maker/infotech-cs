<app-header></app-header>

<main class="product-list-page">
  <div class="container">
    <!-- Breadcrumb Navigation -->
    <nav class="breadcrumb" aria-label="Fil d'Ariane">
      <a routerLink="/" class="breadcrumb-item">
        <svg class="breadcrumb-icon" viewBox="0 0 24 24" fill="none">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" stroke="currentColor" stroke-width="2"/>
          <polyline points="9 22 9 12 15 12 15 22" stroke="currentColor" stroke-width="2"/>
        </svg>
        Accueil
      </a>
      <svg class="breadcrumb-separator" viewBox="0 0 24 24" fill="none">
        <polyline points="9 18 15 12 9 6" stroke="currentColor" stroke-width="2"/>
      </svg>
      <span class="breadcrumb-item active">Produits</span>
    </nav>

    <!-- Page Header -->
    <div class="page-header">
      <div>
        <h1 class="page-title">Nos Produits</h1>
        <p class="page-description">{{ totalElements }} produits disponibles</p>
      </div>
      <button class="btn btn-secondary mobile-filter-toggle" (click)="toggleFilters()">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M22 3H2l8 9.46V19l4 2v-8.54L22 3z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Filtres
      </button>
    </div>

    <div class="content-wrapper">
      <!-- Filters Sidebar -->
      <aside class="filters-sidebar" [class.active]="showFilters">
        <div class="filters-header">
          <h2 class="filters-title">Filtres</h2>
          <button class="btn btn-ghost btn-sm" (click)="clearFilters()">Réinitialiser</button>
        </div>

        <!-- Search -->
        <div class="filter-group">
          <label class="filter-label">Rechercher</label>
          <input 
            type="text" 
            class="form-input" 
            placeholder="Nom du produit..."
            [(ngModel)]="filters.search"
            (ngModelChange)="onFilterChange()">
        </div>

        <!-- Category Filter -->
        <div class="filter-group">
          <label class="filter-label">Catégorie</label>
          <select class="form-select" [(ngModel)]="filters.categoryId" (ngModelChange)="onFilterChange()">
            <option [ngValue]="undefined">Toutes les catégories</option>
            @for (category of categories; track category.id) {
              <option [ngValue]="category.id">{{ category.name }}</option>
            }
          </select>
        </div>

        <!-- Brand Filter -->
        <div class="filter-group">
          <label class="filter-label">Marque</label>
          <select class="form-select" [(ngModel)]="filters.brand" (ngModelChange)="onFilterChange()">
            <option [ngValue]="undefined">Toutes les marques</option>
            @for (brand of brands; track brand) {
              <option [ngValue]="brand">{{ brand }}</option>
            }
          </select>
        </div>

        <!-- Condition Filter -->
        <div class="filter-group">
          <label class="filter-label">État</label>
          <select class="form-select" [(ngModel)]="filters.condition" (ngModelChange)="onFilterChange()">
            <option [ngValue]="undefined">Tous les états</option>
            @for (condition of conditions; track condition) {
              <option [ngValue]="condition">{{ condition }}</option>
            }
          </select>
        </div>

        <!-- Price Range -->
        <div class="filter-group">
          <label class="filter-label">Prix</label>
          <div class="price-inputs">
            <input 
              type="number" 
              class="form-input" 
              placeholder="Min"
              [(ngModel)]="filters.minPrice"
              (ngModelChange)="onFilterChange()">
            <span>-</span>
            <input 
              type="number" 
              class="form-input" 
              placeholder="Max"
              [(ngModel)]="filters.maxPrice"
              (ngModelChange)="onFilterChange()">
          </div>
        </div>
      </aside>

      <!-- Products Grid -->
      <div class="products-container">
        @if (isLoading) {
          <div class="loading-state">
            <div class="spinner"></div>
            <p>Chargement des produits...</p>
          </div>
        } @else if (products.length === 0) {
          <div class="empty-state">
            <svg class="empty-icon" viewBox="0 0 24 24" fill="none">
              <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
              <path d="m21 21-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <h3>Aucun produit trouvé</h3>
            <p>Essayez de modifier vos filtres</p>
            <button class="btn btn-primary" (click)="clearFilters()">Réinitialiser les filtres</button>
          </div>
        } @else {
          <div class="products-grid grid grid-3">
            @for (product of products; track product.id) {
              <app-product-card [product]="product" [price]="699"></app-product-card>
            }
          </div>

          <!-- Pagination -->
          @if (totalPages > 1) {
            <div class="pagination">
              <button 
                class="pagination-btn"
                [disabled]="filters.page === 0"
                (click)="onPageChange(filters.page! - 1)">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Précédent
              </button>

              <div class="pagination-info">
                Page {{ (filters.page || 0) + 1 }} sur {{ totalPages }}
              </div>

              <button 
                class="pagination-btn"
                [disabled]="filters.page === totalPages - 1"
                (click)="onPageChange(filters.page! + 1)">
                Suivant
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M9 18l6-6-6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
          }
        }
      </div>
    </div>
  </div>

  <!-- Floating Back to Top Button -->
  @if (showBackToTop) {
    <button class="back-to-top" (click)="scrollToTop()" aria-label="Retour en haut">
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M18 15l-6-6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
  }
</main>

<app-footer></app-footer>
